<ng-container *ngIf="data$ | async as data">
  <ng-container *ngIf="!data.assignments.length">
    <div class="empty">Looks like nothing is here...</div></ng-container
  >
  <div class="container">
    <div class="project-container">
      <mat-form-field class="selector">
        <mat-label>Choose Project</mat-label>
        <mat-select
          [value]="data.currentProject"
          (valueChange)="onSelectChange($event)"
        >
          @for (project of data.projects; track project) {
          <mat-option [value]="project.id">{{ project.name }}</mat-option>
          }
          <mat-option value="all">All</mat-option>
        </mat-select>
      </mat-form-field>

      <div>
        <div class="header-group">
          <h4 class="title">
            {{
              data.currentProject !== "all"
                ? data.assignments[0].project?.name
                : "All"
            }}
          </h4>
          <div class="btn-wrapper">
            <button mat-raised-button color="primary" [routerLink]="['create']">
              + New task
            </button>
          </div>
        </div>

        <table
          mat-table
          [dataSource]="data.assignments"
          class="mat-elevation-z8"
        >
          <ng-container *ngIf="data.currentProject === 'all'" matColumnDef="projectName">
            <th mat-header-cell *matHeaderCellDef>Project</th>
            <td mat-cell *matCellDef="let assignment" class="projectName-value">
              {{ assignment.project.name }}
            </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let assignment">
              {{ assignment.name }}
            </td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef>Description</th>
            <td mat-cell *matCellDef="let assignment" class="description-value">
              {{ assignment.description }}
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let assignment">
              <ng-container [ngSwitch]="assignment.status">
                <ng-container *ngSwitchCase="0"> ToDo </ng-container>
                <ng-container *ngSwitchCase="1"> In Progress </ng-container>
                <ng-container *ngSwitchCase="2"> Done </ng-container>
              </ng-container>
            </td>
          </ng-container>

          <ng-container matColumnDef="priority">
            <th mat-header-cell *matHeaderCellDef>Priority</th>
            <td mat-cell *matCellDef="let assignment">
              <ng-container [ngSwitch]="assignment.priority">
                <ng-container *ngSwitchCase="0"> Low </ng-container>
                <ng-container *ngSwitchCase="1"> Medium </ng-container>
                <ng-container *ngSwitchCase="2"> High </ng-container>
              </ng-container>
            </td>
          </ng-container>

          <ng-container matColumnDef="assignee">
            <th mat-header-cell *matHeaderCellDef>Assignee</th>
            <td mat-cell *matCellDef="let assignment">
              {{ assignment.assignee?.firstName }}
              {{ assignment.assignee?.secondName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="deadline">
            <th mat-header-cell *matHeaderCellDef>Deadline</th>
            <td mat-cell *matCellDef="let assignment">
              {{ assignment.deadline | date : "dd.MM.yyyy" }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let assignment">
              <button
                mat-flat-button
                color="accent"
                [routerLink]="['edit', assignment.id]"
              >
                Edit
              </button>
              |
              <button
                mat-flat-button
                color="warn"
                (click)="onDelete(assignment.id)"
              >
                Delete
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    </div>
  </div>
</ng-container>
